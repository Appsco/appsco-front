<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/social-icons.html">

<link rel="import" href="appsco-dropdown.html">
<link rel="import" href="appsco-account-notifications.html">

<!--
`appsco-account-notifications-action`
Is used to present notifications action.

Example:

    <body>
      <appsco-account-notifications-action>
     </appsco-account-notifications-action>

 Custom property | Description | Default
----------------|-------------|----------
`--appsco-account-action-color` | Color for icon-button action | ``
`--appsco-account-new-notifications-color` | Color for icon-button action when there are new notifications | ``
`--appsco-account-notifications-action` | Mixin applied to root element | `{}`
`--appsco-account-notifications-dropdown` | Mixin applied to inner appsco-dropdown within root element | `{}`
`--appsco-account-active-action` | Mixin applied to action in active state | `{}`

@demo demo/appsco-account-notifications-action.html
-->

<dom-module id="appsco-account-notifications-action">
    <template>
        <style include="iron-flex iron-flex-alignment">
            :host {
                display: inline-block;
                position: relative;

                @apply(--appsco-account-notifications-action);
            }
            :host .action-icon {
                color: var(--appsco-account-action-color);
                --paper-icon-button-ink-color: var(--appsco-account-action-color);
            }
            :host[_pressed] .action-icon {
                border-radius: 50%;

                @apply(--shadow-elevation-2dp);
                @apply(--appsco-account-active-action);
            }
            :host .new-notifications-icon {
                color: var(--appsco-account-new-notifications-color, --primary-color);
                --paper-icon-button-ink-color: var(--appsco-account-new-notifications-color, --primary-color);
            }
            :host appsco-dropdown {
                top: 45px;

                @apply(--appsco-account-notifications-dropdown);
            }
        </style>

        <template is="dom-if" if="[[ _newNotifications ]]">
            <paper-icon-button
                    id="newNotificationsAction"
                    class="action-icon new-notifications-icon"
                    icon="social:notifications-active"
                    title="Notifications"
                    on-tap="_onNewNotificationsAction">
            </paper-icon-button>
        </template>

        <template is="dom-if" if="[[ !_newNotifications ]]">
            <paper-icon-button
                    id="notificationsAction"
                    class="action-icon"
                    icon="social:notifications"
                    title="Notifications"
                    on-tap="_onNotificationsAction">
            </paper-icon-button>
        </template>

        <appsco-dropdown
                open="{{ _pressed }}"
                trigger="[[ _triggerDropdown ]]"
                close-outside>

            <appsco-account-notifications
                    id="appscoAccountNotifications"
                    authorization-token="[[ authorizationToken ]]"
                    notifications-api="[[ notificationsApi ]]"
                    size="[[ notificationsSize ]]"
                    on-new-notifications="_onNewNotifications">
            </appsco-account-notifications>

        </appsco-dropdown>

    </template>

    <script>
        Polymer({

            is: 'appsco-account-notifications-action',

            properties: {

                /**
                 * Authorization token
                 */
                authorizationToken: {
                    type: String
                },

                /**
                 * Notifications API link.
                 */
                notificationsApi: {
                    type: String
                },

                /**
                 * Number of notifications to load.
                 */
                notificationsSize: {
                    type: Number,
                    value: 5
                },

                /**
                 * Indicates if there are new notifications.
                 */
                _newNotifications: {
                    type: Boolean,
                    value: false
                },

                /**
                 * Indicates if user clicked on element or not.
                 */
                _pressed: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                /**
                 * DOM element which triggers the dropdown.
                 */
                _triggerDropdown: {
                    type: Object,
                    notify: true
                }
            },

            attached: function() {
                this._triggerDropdown = this.$$('#notificationsAction');
            },

            /**
             * Toggles chat dropdown.
             *
             * @private
             */
            _toggleDropdownAction: function() {
                this._pressed = !this._pressed;

                if (this._pressed) {
                    this.$.appscoAccountNotifications.loadNotifications();
                }
            },

            /**
             * Called if there are new notifications.
             *
             * @private
             */
            _onNewNotifications: function() {
                this._newNotifications = true;
            },

            /**
             * Handles notifications action.
             *
             * @private
             */
            _onNotificationsAction: function() {
                this._triggerDropdown = this.$$('#notificationsAction');
                this._toggleDropdownAction();
            },

            /**
             * Handles notifications action when there are new notifications.
             *
             * @private
             */
            _onNewNotificationsAction: function() {
                this._triggerDropdown = this.$$('#newNotificationsAction');
                this._newNotifications = false;
                this._toggleDropdownAction();
            }

        });
    </script>
</dom-module>
