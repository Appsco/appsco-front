<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">

<link rel="import" href="../../bower_components/appsco-vault/appsco-vault-login.html">
<link rel="import" href="../../bower_components/appsco-vault/appsco-vault-identity.html">
<link rel="import" href="../../bower_components/appsco-vault/appsco-vault-software-license.html">
<link rel="import" href="../../bower_components/appsco-vault/appsco-vault-passport.html">
<link rel="import" href="../../bower_components/appsco-vault/appsco-vault-secure-note.html">

<dom-module id="appsco-vault-manage-item">
    <template>
        <style>
            :host {
                display: block;
                position: relative;
                @apply(--appsco-vault-manage-item);
            }
            :host paper-dialog {
                width: 670px;
                padding-bottom: 20px;
            }
        </style>
        <paper-dialog
                with-backdrop
                id="manageDialog"
                entry-animation="scale-up-animation"
                exit-animation="fade-out-animation"
                on-iron-overlay-closed="_onDialogClosed">

            <h2>Manage [[ item.displayTitle ]]</h2>

            <template is="dom-if" if="[[ login ]]">
                <appsco-vault-login
                        id="appscoVaultLogin"
                        item="[[ item ]]"
                        authorization-token="[[ authorizationToken ]]"
                        vault-login-api="[[ api.vaultLogin ]]"
                        on-vault-item-saved="_onItemSaved"
                        ></appsco-vault-login>
            </template>

            <template is="dom-if" if="[[ identity ]]">
                <appsco-vault-identity
                        id="appscoVaultIdentity"
                        identity="[[ item ]]"
                        authorization-token="[[ authorizationToken ]]"
                        vault-identity-api="[[ api.vaultIdentity ]]"
                        on-vault-item-saved="_onItemSaved"
                ></appsco-vault-identity>
            </template>

            <template is="dom-if" if="[[ softwareLicence ]]">
                <appsco-vault-software-license
                        id="appscoVaultSoftwareLicense"
                        item="[[ item ]]"
                        authorization-token="[[ authorizationToken ]]"
                        vault-software-license-api="[[ api.vaultSoftwareLicence ]]"
                        on-vault-item-saved="_onItemSaved"
                        ></appsco-vault-software-license>
            </template>

            <template is="dom-if" if="[[ passport ]]">
                <appsco-vault-passport
                        id="appscoVaultPassport"
                        item="[[ item ]]"
                        authorization-token="[[ authorizationToken ]]"
                        vault-passport-api="[[ api.vaultPassport ]]"
                        on-vault-item-saved="_onItemSaved"
                        ></appsco-vault-passport>
            </template>

            <template is="dom-if" if="[[ secureNote ]]">
                <appsco-vault-secure-note
                        id="appscoVaultSecureNote"
                        item="[[ item ]]"
                        authorization-token="[[ authorizationToken ]]"
                        vault-secure-note-api="[[ api.vaultSecureNote ]]"
                        on-vault-item-saved="_onItemSaved"
                        ></appsco-vault-secure-note>
            </template>
        </paper-dialog>

    </template>
    <script>
        Polymer({

            is: 'appsco-vault-manage-item',

            properties: {
                authorizationToken: {
                    type: String,
                    value: ''
                },

                /**
                 * Vault item to be removed
                 */
                item: {
                    type: Object,
                    value: function() {
                        return {};
                    },
                    notify: true,
                    observer: '_onItemChange'
                },

                api: {
                    type: Object,
                    notify: true
                },

                /**
                 * Indicates if item is has Login type.
                 */
                login: {
                    type: Boolean,
                    value: false
                },

                /**
                 * Indicates if item is has Credit Card type.
                 */
                creditCard: {
                    type: Boolean,
                    value: false
                },

                /**
                 * Indicates if item is has Identity type.
                 */
                identity: {
                    type: Boolean,
                    value: false
                },

                /**
                 * Indicates if item is has Software Licence type.
                 */
                softwareLicence: {
                    type: Boolean,
                    value: false
                },

                /**
                 * Indicates if item is has Passport type.
                 */
                passport: {
                    type: Boolean,
                    value: false
                },

                /**
                 * Indicates if item is has Secure Note type.
                 */
                secureNote: {
                    type: Boolean,
                    value: false
                }
            },

            _onItemChange: function() {
                this.setDialog(this.item.vaultType);
            },

            setDialog: function(action) {
                this.login = (action === 'login');
                this.creditCard = (action === 'credit-card');
                this.identity = (action === 'identity');
                this.softwareLicence = (action === 'software-licence');
                this.passport = (action === 'passport');
                this.secureNote = (action === 'secure-note');
            },

            open: function () {
                this.$.manageDialog.open();
            },

            close: function () {
                this.$.manageDialog.close();
            },

            _onItemSaved: function(event) {
                this.fire('item-saved', {
                   item: event.detail.item
                });

                this.close();
            },

            _onDialogClosed: function() {
                this.set('item', {});

                this.login = false;
                this.creditCard = false;
                this.identity = false;
                this.softwareLicence = false;
                this.passport = false;
                this.secureNote = false;

                if (this.login) {
                    this.$$('#appscoVaultLogin').reset();
                }

                if (this.identity) {
                    this.$$('#appscoVaultIdentity').reset();
                }

                if (this.softwareLicence) {
                    this.$$('#appscoVaultSoftwareLicense').reset();
                }

                if (this.passport) {
                    this.$$('#appscoVaultPassport').reset();
                }

                if (this.secureNote) {
                    this.$$('#appscoVaultSecureNote').reset();
                }
            }
        });
    </script>
</dom-module>
