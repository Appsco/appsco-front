<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">

<dom-module id="appsco-application-page-actions">
    <template>
        <style>
            :host {
            @apply(--layout-horizontal);
            @apply(--layout-center);
            @apply(--layout-end-justified);

                --application-action-icon-color: var(--app-primary-color);

                --paper-input-container-color: var(--secondary-text-color);
                --paper-input-container-input-color: var(--primary-text-color);
                --paper-input-container-focus-color: var(--primary-text-color);
                --paper-input-container: {
                     padding: 0;
                 };
                --paper-input-container-input: {
                     font-size: 14px;
                 };
                --paper-input-container-label: {
                     font-size: 14px;
                     bottom: 0;
                     top: initial;
                 };
                --paper-input-container-label-focus: {
                     left: 30px;
                 };
                --paper-input-prefix: {
                     height: 20px;
                     margin-right: 4px;
                     color: var(--secondary-text-color);
                 };
                --paper-icon-button: {
                     width: 24px;
                     height: 24px;
                     padding: 0;
                     color: var(--primary-text-color);
                 };
                --iron-icon-fill-color: var(--application-action-icon-color);
            }
            :host > * {
                height: 100%;
            }
            :host .search-icon {
                width: 18px;
                height: 18px;
                margin: 0;
            }
            :host .clear-icon {
                width: 20px;
                height: 20px;
            }
            :host paper-icon-button::shadow paper-ripple {
                width: 150%;
                height: 150%;
                top: -25%;
                left: -25%;
            }
            .search-subscribers-action {
            @apply(--layout-horizontal);
            @apply(--layout-center);
            @apply(--layout-end-justified);
            }
            .search-subscribers-input {
            @apply(--layout-flex-none);
                max-width: 184px;
            }
            .global-page-actions {
                padding-left: 10px;
                margin-left: 16px;
                border-left: 1px solid var(--app-primary-color);
            @apply(--layout-horizontal);
            @apply(--layout-center);
            @apply(--layout-end-justified);
            }
            :host .back-action {
                margin-right: 10px;
            }
            :host .info-action {
                display: none;
            }
            :host([tablet-screen]) .info-action {
                display: block;
            }
        </style>

        <iron-media-query query="(max-width: 800px)" query-matches="{{ tabletScreen }}"></iron-media-query>

        <template is="dom-if" if="[[ _searchSubscribersActive ]]">
            <div class="search-subscribers-action">
                <paper-input id="searchSubscribers"
                             class="search-subscribers-input"
                             label="Search subscribers"
                             on-keyup="_searchSubscribers"
                             no-label-float>
                    <div prefix>
                        <iron-icon icon="search" class="search-icon"></iron-icon>
                    </div>

                    <template is="dom-if" if="[[ _clearSearch ]]">
                        <paper-icon-button id="clear"
                                           class="search-icon clear-icon"
                                           suffix
                                           icon="clear"
                                           on-tap="_clearSubscribersSearch"></paper-icon-button>
                    </template>

                </paper-input>
            </div>
        </template>

        <div class="global-page-actions">
            <paper-icon-button
                    class="back-action"
                    icon="arrow-back"
                    title="Back"
                    on-tap="_backToApplications"></paper-icon-button>

            <paper-icon-button
                    class="info-action"
                    icon="info-outline"
                    title="Application Resource"
                    on-tap="_onResourceAction"></paper-icon-button>
        </div>
    </template>

    <script>
        Polymer({

            is: 'appsco-application-page-actions',

            properties: {

                _searchSubscribersActive: {
                    type: Boolean,
                    value: false
                },

                _clearSearch: {
                    type: Boolean,
                    value: false
                },

                _searchDebounce: {
                    type: Number,
                    value: 0
                },

                tabletScreen: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                /**
                 * Animation config with hero animation.
                 */
                animationConfig: {
                    value: function() {
                        return {
                            'entry': {
                                name: 'fade-in-animation',
                                node: this,
                                timing: {
                                    delay: 300,
                                    duration: 300
                                }
                            },
                            'exit': {
                                name: 'fade-out-animation',
                                node: this,
                                timing: {
                                    duration: 200
                                }
                            }
                        }
                    }
                }
            },

            behaviors: [
                Polymer.NeonAnimatableBehavior
            ],

            enableSubscribersSearchAction: function() {
                this._searchSubscribersActive = true;
            },

            disableSubscribersSearchAction: function() {
                this._searchSubscribersActive = false;
            },

            _backToApplications: function() {
                this.fire('back');
            },

            _onResourceAction: function() {
                this.fire('resource-section');
            },

            _searchSubscribers: function() {

                if (this._searchDebounce > 0) {
                    clearTimeout(this._searchDebounce);
                }

                this._searchDebounce = setTimeout(function() {
                    var term = this.$$('#searchSubscribers').value;

                    this.set('_clearSearch', (term.length > 0));

                    if (term.length < 3) {
                        this.fire('search-subscribers', {
                            term: ''
                        });

                        return false;
                    }

                    this.fire('search-subscribers', {
                        term: term
                    });
                }.bind(this), 300);
            },

            _resetSubscribersSearch: function() {
                this.$$('#searchSubscribers').value = '';
                this._clearSearch = false;
            },

            _clearSubscribersSearch: function() {
                this._resetSubscribersSearch();
                this._searchSubscribers();
            },

            resetApplicationSubscribersPageActions: function() {
                this._resetSubscribersSearch();
            }
        });
    </script>
</dom-module>

