<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-styles/shadow.html">
<link rel="import" href="../bower_components/iron-ajax/iron-request.html">

<link rel="import" href="components/get-started/appsco-tutorial-card.html">

<dom-module id="appsco-get-started-page">
    <template>
        <style include="appsco-page-styles">
            :host .tutorials-holder {
                margin-left: 12%;
                margin-right: 12%;
            }
            :host .get-started-header {
                margin-bottom: 20px;
            }
            :host .get-started-header h1 {
                text-align: center;
                font-size: 26px;
                border-bottom: 1px solid #CCC;
                padding-bottom: 10px;
            }
            :host .get-started-header p {
                text-align: center;
                margin: 0;
                padding: 2px;
            }
        </style>

        <appsco-content id="appscoContent">

            <div content>
                <div class="content-container">

                    <div class="get-started-header">
                        <h1>Welcome to AppsCo Business!</h1>
                        <p>Let's guide you through the company setup.</p>
                        <p>Take your time - we'll keep the menu active and save your progress until you're done.</p>
                    </div>

                    <div class="tutorials-holder">
                        <template is="dom-repeat" items="[[ tutorialsArray ]]">
                            <appsco-tutorial-card
                                    tutorial="[[ item ]]"
                                    index="[[ index ]]"
                                    first-unfinished-index="[[ firstUnfinishedIndex ]]"
                                    on-start="_onTutorialStart"
                            ></appsco-tutorial-card>
                        </template>
                    </div>
                </div>
            </div>

        </appsco-content>
    </template>

    <script>
        Polymer({
            is: 'appsco-get-started-page',

            properties: {

                account: {
                    type: Object,
                    value: function() { return {} }
                },

                tutorials: {
                    type: Object,
                    notify: true,
                    observer: "_tutorialsChanged"
                },

                tutorialsArray: {
                    type: Array,
                    value: function() { return []; }
                },

                authorizationToken: {
                    type: String,
                    value: ''
                },

                animationConfig: {
                    value: function() {
                        return {
                            'entry': {
                                name: 'fade-in-animation',
                                node: this,
                                timing: {
                                    duration: 300
                                }
                            },
                            'exit': {
                                name: 'fade-out-animation',
                                node: this,
                                timing: {
                                    duration: 200
                                }
                            }
                        }
                    }
                },

                pageLoaded: {
                    type: Boolean,
                    value: false
                },

                firstUnfinishedIndex: {
                    type: Number,
                    computed: '_computeFirstUnfinishedIndex(tutorials)'
                }
            },

            behaviors: [
                Polymer.NeonAnimatableBehavior
            ],

            attached: function() {
                this._pageLoaded();
            },

            _pageLoaded: function() {
                this.pageLoaded = true;
                this.fire('page-loaded');
            },

            _computeTutorialsArray: function(tutorials) {
                var tutsArray = [];
                for(var idx in tutorials) {
                    if (tutorials.hasOwnProperty(idx)) {
                        tutsArray.push({
                            id: tutorials[idx].getId(),
                            tutorialTitle: tutorials[idx].tutorialTitle,
                            icon: tutorials[idx].icon,
                            description: tutorials[idx].description,
                            readme: tutorials[idx].readme,
                            isDone: tutorials[idx].isDone()
                        });
                    }
                }

                return tutsArray;
            },

            _tutorialsChanged: function(tutorials) {
                this.set('tutorialsArray', []);
                this.set('tutorialsArray', this._computeTutorialsArray(tutorials));
            },

            _computeFirstUnfinishedIndex: function(tutorials) {
                var index = 0;
                for (var idx in this.tutorials) {
                    if (this.tutorials.hasOwnProperty(idx) && !(tutorials[idx].isDone())) {
                        return index;
                    }
                    index++;
                }

                return index;
            }

        });
    </script>

</dom-module>