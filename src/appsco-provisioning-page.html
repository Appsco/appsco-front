<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="components/page/appsco-content.html">
<link rel="import" href="components/page/appsco-page-styles.html">
<link rel="import" href="provisioning/appsco-active-integrations.html">

<dom-module id="appsco-provisioning-page">
    <template>
        <style include="appsco-page-styles"></style>
        <style>
            :host {
                --appsco-active-integration-item: {
                    cursor: default;
                };
                --appsco-active-integration-item-activated: {
                    @apply --shadow-elevation-2dp;
                };
            }
        </style>

        <iron-media-query query="(max-width: 600px)" query-matches="{{ mobileScreen }}"></iron-media-query>

        <appsco-content id="appscoContent">

            <div content slot="content">
                <div class="content-container">
                    <appsco-active-integrations
                            id="appscoActiveIntegrations"
                            type="integration"
                            size="100"
                            load-more
                            authorization-token="[[ authorizationToken ]]"
                            list-api="[[ activeIntegrationsApi ]]"
                            api-errors="[[ apiErrors ]]"
                            on-edit-item="_onIntegrationEditAction"
                            on-list-loaded="_onIntegrationsLoadFinished"
                            on-list-empty="_onIntegrationsLoadFinished"></appsco-active-integrations>
                </div>
            </div>

        </appsco-content>
    </template>

    <script>
        Polymer({
            is: 'appsco-provisioning-page',

            properties: {

                authorizationToken: {
                    type: String,
                    value: ''
                },

                activeIntegrationsApi: {
                    type: String
                },

                apiErrors: {
                    type: Object,
                    value: function() {
                        return {};
                    }
                },

                animationConfig: {
                    value: function() {
                        return {
                            'entry': {
                                name: 'fade-in-animation',
                                node: this,
                                timing: {
                                    duration: 300
                                }
                            },
                            'exit': {
                                name: 'fade-out-animation',
                                node: this,
                                timing: {
                                    duration: 200
                                }
                            }
                        }
                    }
                },

                pageLoaded: {
                    type: Boolean,
                    value: false
                }
            },

            behaviors: [
                Polymer.NeonAnimatableBehavior
            ],

            attached: function() {
                this.pageLoaded = false;
            },

            reloadIntegrations: function() {
                this.$.appscoActiveIntegrations.reloadIntegrations();
            },

            setIntegration: function(integration) {
                this.$.appscoActiveIntegrations.modifyItems([integration]);
            },

            _pageLoaded: function() {
                this.pageLoaded = true;
                this.fire('page-loaded');
            },

            _onIntegrationsLoadFinished: function() {
                this._pageLoaded();
            },

            _onIntegrationEditAction: function(event) {
                this.fire('edit-integration', {
                    integration: event.detail.item
                });
            }
        });
    </script>
</dom-module>
