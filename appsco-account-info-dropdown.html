<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">

<!--
`appsco-account-info-dropdown` represents dropdown element for appsco-account-info element.

Example:

    <body>
        <appsco-account-info-dropdown open="{{ pressed }}" tabindex="-1"></appsco-account-info-dropdown>

@demo demo/appsco-account-info-dropdown.html
-->

<dom-module id="appsco-account-info-dropdown">
    <template>
        <style>
            :host {
                display: none;
                background: transparent;
            }
            :host .content {
                background-color: #ffffff;
                @apply(--shadow-elevation-2dp);
            }
            :host .caret {
                height: 10px;
                position: relative;
                overflow: hidden;
            }
            :host .caret > div:first-child {
                width: 0;
                height: 0;
                border-left: 11px solid transparent;
                border-right: 11px solid transparent;
                border-bottom: 11px solid rgba(0,0,0, 0.2);
                position: absolute;
                right: 10px;
            }
            :host .caret > div:last-child {
                width: 0;
                height: 0;
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                border-bottom: 10px solid var(--caret-color, #ffffff);
                position: absolute;
                right: 11px;
            }
            :host[open] {
                display: block;
            }
            :host[data-info] .caret > div:last-child {
                border-bottom-color: var(--info-background-color);
            }
        </style>
        <div class="caret">
            <div></div>
            <div></div>
        </div>
        <div class="content"><content></content></div>
    </template>

    <script>

        Polymer({
            is: 'appsco-account-info-dropdown',

            behaviors: [
                Polymer.NeonAnimationRunnerBehavior
            ],

            properties: {

                /**
                 * Animation for dropdown appearance.
                 */
                animationConfig: {
                    type: Object,
                    value: function() {
                        return {
                            'entry': {
                                name: 'scale-up-animation',
                                node: this,
                                axis: 'y',
                                transformOrigin: '0 0',
                                timing: {
                                    duration: 300
                                }
                            },
                            'exit': {
                                name: 'fade-out-animation',
                                node: this,
                                timing: {
                                    duration: 200
                                }
                            }
                        }
                    }
                },

                /**
                 * Indicates whether dropdown is opened or not.
                 * This value comes from an element that triggers dropdown to toggle.
                 */
                open: {
                    type: Boolean,
                    value: false,
                    notify: true,
                    reflectToAttribute: true
                },

                /**
                 * Indicates if user clicks inside dropdown.
                 */
                trigger: {
                    type: Object,
                    value: {},
                    notify: true
                }
            },

            listeners: {
                'neon-animation-finish': '_onAnimationFinish',
                'open-changed': '_openChanged'
            },

            ready: function() {

                Polymer.Gestures.add(document, 'tap', this._handleDocumentClick.bind(this));

            },

            /**
             * Evaluates if element is in given path.
             *
             * @param {HTMLElement} element The element to be evaluated.
             * @param {Array<HTMLElements>=} path Elements in path to be checked against item element.
             * @return {Boolean}
             *
             * @private
             */
            _isInPath: function(path, element) {
                path = path || [];

                for (var i = 0; i < path.length; i++) {

                    if (path[i] == element) {
                        return true;

                        break;
                    }
                }

                return false;
            },

            /**
             * Listens for click outside of dropdown in order to close it.
             * @private
             */
            _handleDocumentClick: function(e) {
                var path = Polymer.dom(e).path;

                if (!this._isInPath(path, this) && !this._isInPath(path, this.trigger)) {
                    this.open = false;
                }

            },

            /**
             * It is called after dropdown animation is finished.
             * @private
             */
            _onAnimationFinish: function() {

                if (!this.open) {
                    this.style.display = 'none';
                }

            },

            /**
             * Listen for 'open' property change.
             * If it is true it shows the dropdown.
             * If it is false it hides the dropdown.
             * @private
             */
            _openChanged: function() {

                if (this.open) {
                    this.style.display = 'block';
                    this.playAnimation('entry');
                }
                else {
                    this.playAnimation('exit');
                }

            }
        });
    </script>
</dom-module>
